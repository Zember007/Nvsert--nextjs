import{jsx as e,jsxs as n,Fragment as t}from"react/jsx-runtime";import{useRef as o,useReducer as i,createContext as r,useEffect as a,useLayoutEffect as c,useMemo as s,useCallback as l,useState as u,useContext as d,useImperativeHandle as h,Children as m,cloneElement as f}from"react";import{createPortal as v}from"react-dom";function g(){return g=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},g.apply(null,arguments)}function p(e,n){if(null==e)return{};var t={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(-1!==n.indexOf(o))continue;t[o]=e[o]}return t}function w(e){const{current:n}=o({fn:e,curr:void 0});if(n.fn=e,!n.curr){const t=Object.create(null);Object.keys(e).forEach(e=>{t[e]=(...t)=>n.fn[e].call(n.fn,...t)}),n.curr=t}return n.curr}function b(e){return i((e,n)=>g({},e,"function"==typeof n?n(e):n),e)}var x=r(void 0);const y="cubic-bezier(0.25, 0.8, 0.25, 1)",C=1,k="undefined"!=typeof window&&"ontouchstart"in window,_=(e,n,t)=>Math.max(Math.min(e,t),n),P=(e,n=0,t=0)=>_(e,1*(1-t),Math.max(6,n)*(1+t));var N="undefined"==typeof window||/ServerSideRendering/.test(navigator&&navigator.userAgent)?a:c;function S(e,n,t){const i=o(n);i.current=n,a(()=>{function n(e){i.current(e)}return e&&window.addEventListener(e,n,t),()=>{e&&window.removeEventListener(e,n)}},[e])}const $=["container"];function Y(n){let{container:t=document.body}=n,o=p(n,$);return v(e("div",g({},o)),t)}function X(t){return n("button",g({},t,{children:[n("div",{className:"in",children:[e("div",{className:"close-button-block"}),e("div",{className:"close-button-block"})]}),n("div",{className:"out",children:[e("div",{className:"close-button-block"}),e("div",{className:"close-button-block"})]})]}))}function W(n){return e("svg",g({width:"44",height:"44",viewBox:"0 0 768 768"},n,{children:e("path",{d:"M640.5 352.5v63h-390l178.5 180-45 45-256.5-256.5 256.5-256.5 45 45-178.5 180h390z"})}))}function M(n){return e("svg",g({width:"44",height:"44",viewBox:"0 0 768 768"},n,{children:e("path",{d:"M384 127.5l256.5 256.5-256.5 256.5-45-45 178.5-180h-390v-63h390l-178.5-180z"})}))}function T(){return a(()=>{const{style:e}=document.body,n=e.overflow;return e.overflow="hidden",()=>{e.overflow=n}},[]),null}function V(e){const{clientX:n,clientY:t}=e.touches[0];if(e.touches.length>=2){const{clientX:o,clientY:i}=e.touches[1];return[(n+o)/2,(t+i)/2,Math.sqrt((o-n)**2+(i-t)**2)]}return[n,t,0]}const A=(e,n,t,o)=>{const i=t*n,r=(i-o)/2;let a,c=e;return i<=o?(a=1,c=0):e>0&&r-e<=0?(a=2,c=r):e<0&&r+e<=0&&(a=3,c=-r),[a,c]};function R(e,n,t,o,i,r,a=innerWidth/2,c=innerHeight/2,s=0,l=0){const[u]=A(e,r,t,innerWidth),[d]=A(n,r,o,innerHeight),h=innerWidth/2,m=innerHeight/2;return{x:a-r/i*(a-(h+e))-h+(o/t>=3&&t*r===innerWidth?0:u?s/2:s),y:c-r/i*(c-(m+n))-m+(d?l/2:l),lastCX:a,lastCY:c}}function E(e,n,t){const o=e%180!=0;return o?[t,n,o]:[n,t,o]}function L(e,n,t){const[o,i,r]=E(t,innerWidth,innerHeight);let a=0,c=o,s=i;const l=e/n*i,u=n/e*o;return e<o&&n<i?(c=e,s=n):e<o&&n>=i?c=l:e>=o&&n<i||e/n>o/i?s=u:n/e>=3&&!r?(s=u,a=(s-i)/2):c=l,c>448&&(c=448,s=n/e*448),{width:c,height:s,x:0,y:a,pause:!0}}function I(e,{leading:n=!1,maxWait:t,wait:i=t||0}){const r=o(e);r.current=e;const a=o(0),c=o(null),s=()=>c.current&&clearTimeout(c.current),u=l((...e)=>{const o=Date.now();function l(){a.current=o,s(),r.current.apply(null,e)}const u=a.current,d=o-u;if(0===u&&(n&&l(),a.current=o),void 0!==t){if(d>t)return void l()}else d<i&&(a.current=o);s(),c.current=setTimeout(()=>{l(),a.current=0},i)},[i,t,n]);return u.cancel=s,u}const H=(e,n,t)=>O(e,n,t,100,e=>e,()=>O(n,e,t)),D=e=>1-(1-e)**4;function O(e,n,t,o=400,i=D,r){const a=n-e;if(0===a)return;const c=Date.now();let s=0;const l=()=>{const n=Math.min(1,(Date.now()-c)/o);t(e+i(n)*a)&&n<1?u():(cancelAnimationFrame(s),n>=1&&r&&r())};function u(){s=requestAnimationFrame(l)}u()}const F={T:0,L:0,W:0,H:0,FIT:void 0},B=()=>{const e=o(!1);return a(()=>(e.current=!0,()=>{e.current=!1}),[]),e},q=["className"];function j(t){let{className:o=""}=t,i=p(t,q);return e("div",g({className:`PhotoView__Spinner ${o}`},i,{children:n("svg",{viewBox:"0 0 32 32",width:"36",height:"36",fill:"white",children:[e("path",{opacity:".25",d:"M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4"}),e("path",{d:"M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z"})]})}))}const z=["src","loaded","broken","className","onPhotoLoad","loadingElement","brokenElement"];function K(o){let{src:i,loaded:r,broken:a,className:c,onPhotoLoad:s,loadingElement:l,brokenElement:u}=o,d=p(o,z);const h=B();return i&&!a?n(t,{children:[e("div",{className:"PhotoView__Photo__attr",children:e("img",g({className:"PhotoView__Photo"+(c?` ${c}`:""),src:i,onLoad:function(e){const{naturalWidth:n,naturalHeight:t}=e.target;h.current&&s({loaded:!0,naturalWidth:n,naturalHeight:t})},onError:function(){h.current&&s({broken:!0})},draggable:!1,alt:"document"},d))}),!r&&(l?e("span",{className:"PhotoView__icon",children:l}):e(j,{className:"PhotoView__icon"}))]}):u?e("span",{className:"PhotoView__icon",children:"function"==typeof u?u({src:i}):u}):null}const G={naturalWidth:void 0,naturalHeight:void 0,width:void 0,height:void 0,loaded:void 0,broken:!1,x:0,y:0,touched:!1,maskTouched:!1,rotate:0,scale:1,CX:0,CY:0,lastX:0,lastY:0,lastCX:0,lastCY:0,lastScale:1,touchTime:0,touchLength:0,pause:!0,stopRaf:!0,reach:void 0};function U({item:{src:n,render:t,width:i=0,height:r=0,originRef:c},visible:s,speed:l,easing:d,wrapClassName:h,className:m,style:f,loadingElement:v,brokenElement:p,onPhotoTap:x,onMaskTap:y,onReachMove:C,onReachUp:_,onPhotoResize:$,isActive:Y,expose:X}){const[W,M]=b(G),T=o(0),D=B(),{naturalWidth:q=i,naturalHeight:j=r,width:z=i,height:U=r,loaded:J=!n,broken:Q,x:Z,y:ee,touched:ne,stopRaf:te,maskTouched:oe,rotate:ie,scale:re,CX:ae,CY:ce,lastX:se,lastY:le,lastCX:ue,lastCY:de,lastScale:he,touchTime:me,touchLength:fe,pause:ve,reach:ge}=W,pe=w({onScale:e=>we(P(e)),onRotate(e){ie!==e&&(X({rotate:e}),M(g({rotate:e},L(q,j,e))))}});function we(e,n,t){re!==e&&(X({scale:e}),M(g({scale:e},R(Z,ee,z,U,re,e,n,t),e<=1&&{x:0,y:0})))}const be=I((e,n,t=0)=>{if((ne||oe)&&Y){const[o,i]=E(ie,z,U);if(0===t&&0===T.current){const t=Math.abs(e-ae)<=20,o=Math.abs(n-ce)<=20;if(t&&o)return void M({lastCX:e,lastCY:n});T.current=t?n>ce?3:2:1}const r=e-ue,a=n-de;let c;if(0===t){const[t]=A(r+se,re,o,innerWidth),[s]=A(a+le,re,i,innerHeight);c=((e,n,t,o)=>n&&1===e||"x"===o?"x":t&&e>1||"y"===o?"y":void 0)(T.current,t,s,ge),void 0!==c&&C(c,e,n,re)}if("x"===c||oe)return void M({reach:"x"});const s=P(re+(t-fe)/100/2*re,q/z,.2);X({scale:s}),M(g({touchLength:t,reach:c,scale:s},R(Z,ee,z,U,re,s,e,n,r,a)))}},{maxWait:8});function xe(e){return!te&&!ne&&(D.current&&M(g({},e,{pause:s})),D.current)}const ye=function(){const e=w({X:e=>xe({x:e}),Y:e=>xe({y:e}),S:e=>{return n=e,D.current&&(X({scale:n}),M({scale:n})),!ne&&D.current;var n}});return(n,t,o,i,r,a,c,s,l,u,d)=>{const[h,m]=E(u,r,a),[f,v]=A(n,s,h,innerWidth),[g,p]=A(t,s,m,innerHeight),w=Date.now()-d;if(w>=200||s!==c||Math.abs(l-c)>1){const{x:o,y:i}=R(n,t,r,a,c,s),l=f?v:o!==n?o:null,u=g?p:i!==t?i:null;return null!==l&&O(n,l,e.X),null!==u&&O(t,u,e.Y),void(s!==c&&O(c,s,e.S))}const b=(n-o)/w,x=(t-i)/w,y=Math.sqrt(b**2+x**2);let C=!1,k=!1;!function(e,n){let t,o=e,i=0,r=0;const a=r=>{t||(t=r);const a=r-t,l=Math.sign(e),u=-.001*l,d=Math.sign(-o)*o**2*2e-4,h=o*a+(u+d)*a**2/2;o+=(u+d)*a,i+=h,t=r,l*o<=0?s():n(i)?c():s()};function c(){r=requestAnimationFrame(a)}function s(){cancelAnimationFrame(r)}c()}(y,o=>{const i=n+o*(b/y),r=t+o*(x/y),[a,s]=A(i,c,h,innerWidth),[l,u]=A(r,c,m,innerHeight);if(a&&!C&&(C=!0,f?O(i,s,e.X):H(s,i+(i-s),e.X)),l&&!k&&(k=!0,g?O(r,u,e.Y):H(u,r+(r-u),e.Y)),C&&k)return!1;const d=C||e.X(s),v=k||e.Y(u);return d&&v})}}(),Ce=function(e){const n=o(0),t=I((...t)=>{n.current=0,e(...t)},{wait:300});return function(...e){n.current+=1,t(...e),n.current>=2&&(t.cancel(),n.current=0,((e,n)=>{ge||we(1!==re?1:Math.max(2,q/z),e,n)})(...e))}}(x);function ke(e,n){if(T.current=0,(ne||oe)&&Y){M({touched:!1,maskTouched:!1,pause:!1,stopRaf:!1,reach:void 0});const t=P(re,q/z);if(ye(Z,ee,se,le,z,U,re,t,he,ie,me),_(e,n),ae===e&&ce===n){if(ne)return void Ce(e,n);oe&&y(e,n)}}}function _e(e,n,t=0){M({touched:!0,CX:e,CY:n,lastCX:e,lastCY:n,lastX:Z,lastY:ee,lastScale:re,touchLength:t,touchTime:Date.now()})}function Pe(e){M({maskTouched:!0,CX:e.clientX,CY:e.clientY,lastX:Z,lastY:ee})}S(k?void 0:"mousemove",e=>{e.preventDefault(),be(e.clientX,e.clientY)}),S(k?void 0:"mouseup",e=>{ke(e.clientX,e.clientY)}),S(k?"touchmove":void 0,e=>{e.preventDefault();const n=V(e);be(...n)},{passive:!1}),S(k?"touchend":void 0,({changedTouches:e})=>{const n=e[0];ke(n.clientX,n.clientY)},{passive:!1}),S("resize",I(()=>{J&&!ne&&(M(L(q,j,ie)),$())},{maxWait:8})),N(()=>{Y&&X(g({scale:re,rotate:ie},pe))},[Y]);const[Ne,Se,$e,Ye,Xe,We,Me,Te]=function(e,n,t,i,r,c,s,l,d,h){const[m,f,v]=function(e,n,t,i,r){const a=o(!1),[{lead:c,scale:s},l]=b({lead:!0,scale:t}),u=I(async e=>{r(!0),l({lead:!1,scale:e})},{wait:i});return N(()=>{a.current?(r(!1),l({lead:!0}),u(t)):a.current=!0},[t]),c?[e*s,n*s,t/s]:[e*t,n*t,1]}(c,s,l,d,h),[g,p]=function(e,n,t,i,r){const[c,s]=u(F),[l,d]=u(0),h=o(null),m=w({OK:()=>e&&d(4)});function f(e){r(!1),d(e)}return a(()=>{if(h.current||(h.current=Date.now()),t){if(function(e,n){const t=e&&e.current;if(t&&1===t.nodeType){const{top:e,left:o,width:i,height:r}=t.getBoundingClientRect();n({T:e,L:o,W:i,H:r,FIT:"IMG"===t.tagName?getComputedStyle(t).objectFit:void 0})}}(n,s),e)return Date.now()-h.current<250?(d(1),requestAnimationFrame(()=>{d(2),requestAnimationFrame(()=>f(3))}),void setTimeout(m.OK,i)):void d(4);f(5)}},[e,t]),[l,c]}(e,n,t,d,h),{T:x,L:y,W:C,H:k,FIT:_}=p,P=innerWidth/2,S=innerHeight/2,$=g<3||g>4;return[$?C?y:P:i+(P-c*l/2),$?C?x:S:r+(S-s*l/2),m,$&&_?m*(k/C):f,0===g?v:$?C/(c*l)||.01:v,$?_?1:0:1,g,_]}(s,c,J,Z,ee,z,U,re,l,e=>M({pause:e})),Ve=`transform ${l}ms ${d}`,Ae={className:m,onMouseDown:k?void 0:function(e){e.stopPropagation(),0===e.button&&_e(e.clientX,e.clientY,0)},onTouchStart:k?function(e){e.stopPropagation(),_e(...V(e))}:void 0,onWheel:function(e){if(!ge){const n=P(re-e.deltaY/100/2,q/z);M({stopRaf:!0}),we(n,e.clientX,e.clientY)}},style:{width:`${$e}px`,height:`${Ye}px`,opacity:We,objectFit:4===Me?void 0:Te,transform:ie?`rotate(${ie}deg)`:void 0,transition:Me>2?`${Ve}, opacity ${l}ms ease, height ${Me<4?l/2:Me>4?l:0}ms ${d}`:void 0}};return e("div",{className:"PhotoView__PhotoWrap"+(h?` ${h}`:""),style:f,onMouseDown:!k&&Y?Pe:void 0,onTouchStart:k&&Y?e=>Pe(e.touches[0]):void 0,children:e("div",{className:"PhotoView__PhotoBox",style:{transform:`matrix(${Xe}, 0, 0, ${Xe}, ${Ne}, ${Se})`,transition:ne||ve?void 0:Ve,willChange:Y?"transform":void 0},children:n?e(K,g({src:n,loaded:J,broken:Q},Ae,{onPhotoLoad:function(e){M(g({},e,e.loaded&&L(e.naturalWidth||0,e.naturalHeight||0,ie)))},loadingElement:v,brokenElement:p})):t&&t({attrs:Ae,scale:Xe,rotate:ie})})})}const J={x:0,touched:!1,pause:!1,lastCX:void 0,lastCY:void 0,bg:void 0,lastBg:void 0,overlay:!0,minimal:!0,scale:1,rotate:0};function Q(r){const{loop:c=3,speed:l,easing:d,photoClosable:h,maskClosable:m=!0,maskOpacity:f=C,pullClosable:v=!0,bannerVisible:g=!0,overlayRender:p,toolbarRender:x,className:P,maskClassName:$,photoClassName:V,photoWrapClassName:A,loadingElement:R,brokenElement:E,images:L,index:I=0,onIndexChange:H,visible:D,onClose:O,afterClose:F,portalContainer:B}=r,[q,j]=b(J),[z,K]=u(0);u(null);const{x:G,touched:Q,pause:Z,bg:ee=f,lastBg:ne,overlay:te,scale:oe,rotate:ie,onScale:re,onRotate:ae}=q,ce=r.hasOwnProperty("index"),se=ce?I:z,le=ce?H:K,ue=o(se),de=L.length,he=L[se],me="boolean"==typeof c?c:de>c,[fe,ve,ge]=function(e,n){const[,t]=i(e=>!e,!1),r=o(0),[a,c]=function(n){const t=o(n);function i(e){t.current=e}return s(()=>{(n=>{e?(n(e),r.current=1):r.current=2})(i)},[n]),[t.current,i]}(e);return[a,r.current,function(){t(),2===r.current&&(c(!1),n&&n()),r.current=0}]}(D,F);N(()=>{if(fe)return j({pause:!0,x:se*-(innerWidth+20)}),void(ue.current=se);j(J)},[fe]);const{close:pe,changeIndex:we}=w({close(e){ae&&ae(0),j({overlay:!0,lastBg:ee}),O(e)},changeIndex(e,n=!1){const t=me?ue.current+(e-se):e,o=de-1,i=_(t,0,o),r=me?t:i,a=innerWidth+20;j({touched:!1,x:-a*ue.current,lastCX:void 0,lastCY:void 0,bg:f,overlay:te}),j({touched:!1,lastCX:void 0,lastCY:void 0,x:-a*r,pause:n}),ue.current=r,le&&le(me?e<0?o:e>o?0:e:i)}});function be(e){return e?pe():j({overlay:!te})}function xe(){j({x:-(innerWidth+20)*se,lastCX:void 0,lastCY:void 0,pause:!0}),ue.current=se}S("keydown",e=>{if(D)switch(e.key){case"ArrowLeft":we(se-1,!0);break;case"ArrowRight":we(se+1,!0);break;case"Escape":pe()}});const ye=function(e,n,t){return s(()=>{const o=e.length;return t?e.concat(e).concat(e).slice(o+n-1,o+n+2):e.slice(Math.max(n-1,0),Math.min(n+2,o+1))},[e,n,t])}(L,se,me);if(a(()=>{setTimeout(()=>{var e;null==(e=document.querySelector(".Slider_scale"))||e.classList.remove("slider-transitions")},100)},[se]),!fe)return null;const Ce=te&&!ve,ke=D?ee:ne,_e=re&&ae&&{images:L,index:se,visible:D,onClose:pe,onIndexChange:we,overlayVisible:Ce,overlay:he&&he.overlay,scale:oe,rotate:ie,onScale:re,onRotate:ae},Pe=l?l(ve):400,Ne=d?d(ve):y,Se=l?l(3):600,$e=d?d(3):y;return n(Y,{className:`PhotoView-Portal${Ce?"":" PhotoView-Slider__clean"}${D?"":" PhotoView-Slider__willClose"}${P?` ${P}`:""}`,role:"dialog",onClick:e=>e.stopPropagation(),container:B,children:[D&&e(T,{}),e("div",{className:`PhotoView-Slider__Backdrop${$?` ${$}`:""}${1===ve?" PhotoView-Slider__fadeIn":2===ve?" PhotoView-Slider__fadeOut":""}`,style:{background:ke?`rgba(0, 0, 0, ${ke})`:void 0,transitionTimingFunction:Ne,transitionDuration:`${Q?0:Pe}ms`,animationDuration:`${Pe}ms`},onAnimationEnd:ge}),g&&n("div",{className:"PhotoView-Slider__BannerWrap",children:[n("div",{className:"PhotoView-Slider__Counter",children:[se+1," / ",de]}),n("div",{className:"PhotoView-Slider__BannerRight",children:[x&&_e&&x(_e),e(X,{className:"close",onClick:pe})]})]}),e("div",{className:"Slider_scale",children:ye.map((n,t)=>{const o=me||0!==se?ue.current-1+t:se+t;return e(U,{item:n,speed:Pe,easing:Ne,visible:D,onPhotoTap:()=>be(h),onMaskTap:()=>be(m),wrapClassName:A,className:V,style:{left:(innerWidth+20)*o+"px",transform:`translate3d(${G}px, 0px, 0)`,transition:Q||Z?void 0:`transform ${Se}ms ${$e}`},loadingElement:R,brokenElement:E,onPhotoResize:xe,isActive:ue.current===o,expose:j},me?`${n.key}/${n.src}/${o}`:n.key)})}),!k&&g&&n(t,{children:[(me||0!==se)&&e("div",{className:"PhotoView-Slider__ArrowLeft",onClick:()=>{var e;null==(e=document.querySelector(".Slider_scale"))||e.classList.add("slider-transitions"),we(se-1)},children:e(W,{})}),(me||se+1<de)&&e("div",{className:"PhotoView-Slider__ArrowRight",onClick:()=>{var e;null==(e=document.querySelector(".Slider_scale"))||e.classList.add("slider-transitions"),we(se+1)},children:e(M,{})})]}),p&&_e&&e("div",{className:"PhotoView-Slider__Overlay",children:p(_e)})]})}const Z=["children","onIndexChange","onVisibleChange"],ee={images:[],visible:!1,index:0};function ne(t){let{children:i,onIndexChange:r,onVisibleChange:a}=t,c=p(t,Z);const[l,u]=b(ee),d=o(0),{images:h,visible:m,index:f}=l,v=w({nextId:()=>d.current+=1,update(e){const n=h.findIndex(n=>n.key===e.key);if(n>-1){const t=h.slice();return t.splice(n,1,e),void u({images:t})}u(n=>({images:n.images.concat(e)}))},remove(e){u(n=>{const t=n.images.filter(n=>n.key!==e);return{images:t,index:Math.min(t.length-1,f)}})},show(e){const n=h.findIndex(n=>n.key===e);u({visible:!0,index:n}),a&&a(!0,n,l)}}),y=w({close(){u({visible:!1}),a&&a(!1,f,l)},changeIndex(e){u({index:e}),r&&r(e,l)}}),C=s(()=>g({},l,v),[l,v]);return n(x.Provider,{value:C,children:[i,e(Q,g({images:h,visible:m,index:f,onIndexChange:y.changeIndex,onClose:y.close},c))]})}const te=({src:e,render:n,overlay:t,width:i,height:r,triggers:c=["onClick"],children:l})=>{const u=d(x),v=function(){const{current:e}=o({sign:!1,fn:void 0});return e.sign||(e.sign=!0,e.fn=u.nextId()),e.fn}(),p=o(null);h(null==l?void 0:l.ref,()=>p.current),a(()=>()=>{u.remove(v)},[]);const b=w({render:e=>n&&n(e),show(e,n){u.show(v),function(e,n){if(l){const t=l.props[e];t&&t(n)}}(e,n)}}),y=s(()=>{const e={};return c.forEach(n=>{e[n]=b.show.bind(null,n)}),e},[]);return a(()=>{u.update({key:v,src:e,originRef:p,render:b.render,overlay:t,width:i,height:r})},[e]),l?m.only(f(l,g({},y,{ref:p}))):null};export{ne as PhotoProvider,Q as PhotoSlider,te as PhotoView};
//# sourceMappingURL=react-photo-view.modern.js.map
