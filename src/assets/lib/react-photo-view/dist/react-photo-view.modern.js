import e,{useRef as t,useReducer as n,createContext as o,useEffect as r,useLayoutEffect as a,useMemo as i,useCallback as c,useState as l,useContext as s,useImperativeHandle as u,Children as d,cloneElement as h}from"react";import{createPortal as m}from"react-dom";function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},f.apply(null,arguments)}function v(e,t){if(null==e)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(-1!==t.indexOf(o))continue;n[o]=e[o]}return n}function g(e){const{current:n}=t({fn:e,curr:void 0});if(n.fn=e,!n.curr){const t=Object.create(null);Object.keys(e).forEach(e=>{t[e]=(...t)=>n.fn[e].call(n.fn,...t)}),n.curr=t}return n.curr}function p(e){return n((e,t)=>f({},e,"function"==typeof t?t(e):t),e)}var w=o(void 0);const b="cubic-bezier(0.25, 0.8, 0.25, 1)",y=1,E="undefined"!=typeof window&&"ontouchstart"in window,x=(e,t,n)=>Math.max(Math.min(e,n),t),C=(e,t=0,n=0)=>x(e,1*(1-n),Math.max(6,t)*(1+n));var k="undefined"==typeof window||/ServerSideRendering/.test(navigator&&navigator.userAgent)?r:a;function _(e,n,o){const a=t(n);a.current=n,r(()=>{function t(e){a.current(e)}return e&&window.addEventListener(e,t,o),()=>{e&&window.removeEventListener(e,t)}},[e])}const P=["container"];function N(t){let{container:n=document.body}=t,o=v(t,P);return m(e.createElement("div",f({},o)),n)}function $(t){return e.createElement("button",f({},t),e.createElement("div",{className:"in"},e.createElement("div",{className:"close-button-block"}),e.createElement("div",{className:"close-button-block"})),e.createElement("div",{className:"out"},e.createElement("div",{className:"close-button-block"}),e.createElement("div",{className:"close-button-block"})))}function S(t){return e.createElement("svg",f({width:"44",height:"44",viewBox:"0 0 768 768"},t),e.createElement("path",{d:"M640.5 352.5v63h-390l178.5 180-45 45-256.5-256.5 256.5-256.5 45 45-178.5 180h390z"}))}function Y(t){return e.createElement("svg",f({width:"44",height:"44",viewBox:"0 0 768 768"},t),e.createElement("path",{d:"M384 127.5l256.5 256.5-256.5 256.5-45-45 178.5-180h-390v-63h390l-178.5-180z"}))}function X(){return r(()=>{const{style:e}=document.body,t=e.overflow;return e.overflow="hidden",()=>{e.overflow=t}},[]),null}function W(e){const{clientX:t,clientY:n}=e.touches[0];if(e.touches.length>=2){const{clientX:o,clientY:r}=e.touches[1];return[(t+o)/2,(n+r)/2,Math.sqrt((o-t)**2+(r-n)**2)]}return[t,n,0]}const M=(e,t,n,o)=>{const r=n*t,a=(r-o)/2;let i,c=e;return r<=o?(i=1,c=0):e>0&&a-e<=0?(i=2,c=a):e<0&&a+e<=0&&(i=3,c=-a),[i,c]};function T(e,t,n,o,r,a,i=innerWidth/2,c=innerHeight/2,l=0,s=0){const[u]=M(e,a,n,innerWidth),[d]=M(t,a,o,innerHeight),h=innerWidth/2,m=innerHeight/2;return{x:i-a/r*(i-(h+e))-h+(o/n>=3&&n*a===innerWidth?0:u?l/2:l),y:c-a/r*(c-(m+t))-m+(d?s/2:s),lastCX:i,lastCY:c}}function V(e,t,n){const o=e%180!=0;return o?[n,t,o]:[t,n,o]}function R(e,t,n){const[o,r,a]=V(n,innerWidth,innerHeight);let i=0,c=o,l=r;const s=e/t*r,u=t/e*o;return e<o&&t<r?(c=e,l=t):e<o&&t>=r?c=s:e>=o&&t<r||e/t>o/r?l=u:t/e>=3&&!a?(l=u,i=(l-r)/2):c=s,c=448,l=t/e*448,{width:c,height:l,x:0,y:i,pause:!0}}function A(e,{leading:n=!1,maxWait:o,wait:r=o||0}){const a=t(e);a.current=e;const i=t(0),l=t(null),s=()=>l.current&&clearTimeout(l.current),u=c((...e)=>{const t=Date.now();function c(){i.current=t,s(),a.current.apply(null,e)}const u=i.current,d=t-u;if(0===u&&(n&&c(),i.current=t),void 0!==o){if(d>o)return void c()}else d<r&&(i.current=t);s(),l.current=setTimeout(()=>{c(),i.current=0},r)},[r,o,n]);return u.cancel=s,u}const L=(e,t,n)=>H(e,t,n,100,e=>e,()=>H(t,e,n)),I=e=>1-(1-e)**4;function H(e,t,n,o=400,r=I,a){const i=t-e;if(0===i)return;const c=Date.now();let l=0;const s=()=>{const t=Math.min(1,(Date.now()-c)/o);n(e+r(t)*i)&&t<1?u():(cancelAnimationFrame(l),t>=1&&a&&a())};function u(){l=requestAnimationFrame(s)}u()}const F={T:0,L:0,W:0,H:0,FIT:void 0},D=()=>{const e=t(!1);return r(()=>(e.current=!0,()=>{e.current=!1}),[]),e},O=["className"];function B(t){let{className:n=""}=t,o=v(t,O);return e.createElement("div",f({className:`PhotoView__Spinner ${n}`},o),e.createElement("svg",{viewBox:"0 0 32 32",width:"36",height:"36",fill:"white"},e.createElement("path",{opacity:".25",d:"M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4"}),e.createElement("path",{d:"M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z"})))}const q=["src","loaded","broken","className","onPhotoLoad","loadingElement","brokenElement"];function z(t){let{src:n,loaded:o,broken:r,className:a,onPhotoLoad:i,loadingElement:c,brokenElement:l}=t,s=v(t,q);const u=D();return n&&!r?e.createElement(e.Fragment,null,e.createElement("div",{className:`PhotoView__Photo__attr ${!o&&"loaded"}`},e.createElement("img",f({className:"PhotoView__Photo"+(a?` ${a}`:""),src:n,onLoad:function(e){const{naturalWidth:t,naturalHeight:n}=e.target;u.current&&i({loaded:!0,naturalWidth:t,naturalHeight:n})},onError:function(){u.current&&i({broken:!0})},draggable:!1,alt:"document"},s))),!o&&(c?e.createElement("span",{className:"PhotoView__icon"},c):e.createElement(B,{className:"PhotoView__icon"}))):l?e.createElement("span",{className:"PhotoView__icon"},"function"==typeof l?l({src:n}):l):null}const j={naturalWidth:void 0,naturalHeight:void 0,width:void 0,height:void 0,loaded:void 0,broken:!1,x:0,y:0,touched:!1,maskTouched:!1,rotate:0,scale:1,CX:0,CY:0,lastX:0,lastY:0,lastCX:0,lastCY:0,lastScale:1,touchTime:0,touchLength:0,pause:!0,stopRaf:!0,reach:void 0};function K({item:{src:n,render:o,width:a=0,height:i=0,originRef:c},visible:s,speed:u,easing:d,wrapClassName:h,className:m,style:v,loadingElement:w,brokenElement:b,onPhotoTap:y,onMaskTap:x,onReachMove:P,onReachUp:N,onPhotoResize:$,isActive:S,expose:Y}){const[X,I]=p(j),O=t(0),B=D(),{naturalWidth:q=a,naturalHeight:K=i,width:G=a,height:U=i,loaded:J=!n,broken:Q,x:Z,y:ee,touched:te,stopRaf:ne,maskTouched:oe,rotate:re,scale:ae,CX:ie,CY:ce,lastX:le,lastY:se,lastCX:ue,lastCY:de,lastScale:he,touchTime:me,touchLength:fe,pause:ve,reach:ge}=X,pe=g({onScale:e=>we(C(e)),onRotate(e){re!==e&&(Y({rotate:e}),I(f({rotate:e},R(q,K,e))))}});function we(e,t,n){ae!==e&&(Y({scale:e}),I(f({scale:e},T(Z,ee,G,U,ae,e,t,n),e<=1&&{x:0,y:0})))}const be=A((e,t,n=0)=>{if((te||oe)&&S){const[o,r]=V(re,G,U);if(0===n&&0===O.current){const n=Math.abs(e-ie)<=20,o=Math.abs(t-ce)<=20;if(n&&o)return void I({lastCX:e,lastCY:t});O.current=n?t>ce?3:2:1}const a=e-ue,i=t-de;let c;if(0===n){const[n]=M(a+le,ae,o,innerWidth),[l]=M(i+se,ae,r,innerHeight);c=((e,t,n,o)=>t&&1===e||"x"===o?"x":n&&e>1||"y"===o?"y":void 0)(O.current,n,l,ge),void 0!==c&&P(c,e,t,ae)}if("x"===c||oe)return void I({reach:"x"});const l=C(ae+(n-fe)/100/2*ae,q/G,.2);Y({scale:l}),I(f({touchLength:n,reach:c,scale:l},T(Z,ee,G,U,ae,l,e,t,a,i)))}},{maxWait:8});function ye(e){return!ne&&!te&&(B.current&&I(f({},e,{pause:s})),B.current)}const Ee=function(){const e=g({X:e=>ye({x:e}),Y:e=>ye({y:e}),S:e=>{return t=e,B.current&&(Y({scale:t}),I({scale:t})),!te&&B.current;var t}});return(t,n,o,r,a,i,c,l,s,u,d)=>{const[h,m]=V(u,a,i),[f,v]=M(t,l,h,innerWidth),[g,p]=M(n,l,m,innerHeight),w=Date.now()-d;if(w>=200||l!==c||Math.abs(s-c)>1){const{x:o,y:r}=T(t,n,a,i,c,l),s=f?v:o!==t?o:null,u=g?p:r!==n?r:null;return null!==s&&H(t,s,e.X),null!==u&&H(n,u,e.Y),void(l!==c&&H(c,l,e.S))}const b=(t-o)/w,y=(n-r)/w,E=Math.sqrt(b**2+y**2);let x=!1,C=!1;!function(e,t){let n,o=e,r=0,a=0;const i=a=>{n||(n=a);const i=a-n,s=Math.sign(e),u=-.001*s,d=Math.sign(-o)*o**2*2e-4,h=o*i+(u+d)*i**2/2;o+=(u+d)*i,r+=h,n=a,s*o<=0?l():t(r)?c():l()};function c(){a=requestAnimationFrame(i)}function l(){cancelAnimationFrame(a)}c()}(E,o=>{const r=t+o*(b/E),a=n+o*(y/E),[i,l]=M(r,c,h,innerWidth),[s,u]=M(a,c,m,innerHeight);if(i&&!x&&(x=!0,f?H(r,l,e.X):L(l,r+(r-l),e.X)),s&&!C&&(C=!0,g?H(a,u,e.Y):L(u,a+(a-u),e.Y)),x&&C)return!1;const d=x||e.X(l),v=C||e.Y(u);return d&&v})}}(),xe=function(e){const n=t(0),o=A((...t)=>{n.current=0,e(...t)},{wait:300});return function(...e){n.current+=1,o(...e),n.current>=2&&(o.cancel(),n.current=0,((e,t)=>{ge||we(1!==ae?1:Math.max(2,q/G),e,t)})(...e))}}(y);function Ce(e,t){if(O.current=0,(te||oe)&&S){I({touched:!1,maskTouched:!1,pause:!1,stopRaf:!1,reach:void 0});const n=C(ae,q/G);if(Ee(Z,ee,le,se,G,U,ae,n,he,re,me),N(e,t),ie===e&&ce===t){if(te)return void xe(e,t);oe&&x(e,t)}}}function ke(e,t,n=0){I({touched:!0,CX:e,CY:t,lastCX:e,lastCY:t,lastX:Z,lastY:ee,lastScale:ae,touchLength:n,touchTime:Date.now()})}function _e(e){I({maskTouched:!0,CX:e.clientX,CY:e.clientY,lastX:Z,lastY:ee})}_(E?void 0:"mousemove",e=>{e.preventDefault(),be(e.clientX,e.clientY)}),_(E?void 0:"mouseup",e=>{Ce(e.clientX,e.clientY)}),_(E?"touchmove":void 0,e=>{e.preventDefault();const t=W(e);be(...t)},{passive:!1}),_(E?"touchend":void 0,({changedTouches:e})=>{const t=e[0];Ce(t.clientX,t.clientY)},{passive:!1}),_("resize",A(()=>{J&&!te&&(I(R(q,K,re)),$())},{maxWait:8})),k(()=>{S&&Y(f({scale:ae,rotate:re},pe))},[S]);const[Pe,Ne,$e,Se,Ye,Xe,We,Me]=function(e,n,o,a,i,c,s,u,d,h){const[m,f,v]=function(e,n,o,r,a){const i=t(!1),[{lead:c,scale:l},s]=p({lead:!0,scale:o}),u=A(async e=>{a(!0),s({lead:!1,scale:e})},{wait:r});return k(()=>{i.current?(a(!1),s({lead:!0}),u(o)):i.current=!0},[o]),c?[e*l,n*l,o/l]:[e*o,n*o,1]}(c,s,u,d,h),[w,b]=function(e,n,o,a,i){const[c,s]=l(F),[u,d]=l(0),h=t(null),m=g({OK:()=>e&&d(4)});function f(e){i(!1),d(e)}return r(()=>{if(h.current||(h.current=Date.now()),o){if(function(e,t){const n=e&&e.current;if(n&&1===n.nodeType){const{top:e,left:o,width:r,height:a}=n.getBoundingClientRect();t({T:e,L:o,W:r,H:a,FIT:"IMG"===n.tagName?getComputedStyle(n).objectFit:void 0})}}(n,s),e)return Date.now()-h.current<250?(d(1),requestAnimationFrame(()=>{d(2),requestAnimationFrame(()=>f(3))}),void setTimeout(m.OK,a)):void d(4);f(5)}},[e,o]),[u,c]}(e,n,o,d,h),{T:y,L:E,W:x,H:C,FIT:_}=b,P=innerWidth/2,N=innerHeight/2,$=w<3||w>4;return[$?x?E:P:a+(P-c*u/2),$?x?y:N:i+(N-s*u/2),m,$&&_?m*(C/x):f,0===w?v:$?x/(c*u)||.01:v,$?_?1:0:1,w,_]}(s,c,J,Z,ee,G,U,ae,u,e=>I({pause:e})),Te=`transform ${u}ms ${d}`,Ve={className:m,onMouseDown:E?void 0:function(e){e.stopPropagation(),0===e.button&&ke(e.clientX,e.clientY,0)},onTouchStart:E?function(e){e.stopPropagation(),ke(...W(e))}:void 0,onWheel:function(e){if(!ge){const t=C(ae-e.deltaY/100/2,q/G);I({stopRaf:!0}),we(t,e.clientX,e.clientY)}},style:{width:`${$e}px`,height:`${Se}px`,opacity:Xe,objectFit:4===We?void 0:Me,transform:re?`rotate(${re}deg)`:void 0,transition:We>2?`${Te}, opacity ${u}ms ease, height ${We<4?u/2:We>4?u:0}ms ${d}`:void 0}};return e.createElement("div",{className:"PhotoView__PhotoWrap"+(h?` ${h}`:""),style:v,onMouseDown:!E&&S?_e:void 0,onTouchStart:E&&S?e=>_e(e.touches[0]):void 0},e.createElement("div",{className:"PhotoView__PhotoBox",style:{transform:`matrix(${Ye}, 0, 0, ${Ye}, ${Pe}, ${Ne})`,transition:te||ve?void 0:Te,willChange:S?"transform":void 0}},n?e.createElement(z,f({src:n,loaded:J,broken:Q},Ve,{onPhotoLoad:function(e){I(f({},e,e.loaded&&R(e.naturalWidth||0,e.naturalHeight||0,re)))},loadingElement:w,brokenElement:b})):o&&o({attrs:Ve,scale:Ye,rotate:re})))}const G={x:0,touched:!1,pause:!1,lastCX:void 0,lastCY:void 0,bg:void 0,lastBg:void 0,overlay:!0,minimal:!0,scale:1,rotate:0};function U(o){const{loop:a=3,speed:c,easing:s,photoClosable:u,maskClosable:d=!0,maskOpacity:h=y,pullClosable:m=!0,bannerVisible:f=!0,overlayRender:v,toolbarRender:w,className:C,maskClassName:P,photoClassName:W,photoWrapClassName:M,loadingElement:T,brokenElement:V,images:R,index:A=0,onIndexChange:L,visible:I,onClose:H,afterClose:F,portalContainer:D}=o,[O,B]=p(G),[q,z]=l(0);l(null);const{x:j,touched:U,pause:J,bg:Q=h,lastBg:Z,overlay:ee,scale:te,rotate:ne,onScale:oe,onRotate:re}=O,ae=o.hasOwnProperty("index"),ie=ae?A:q,ce=ae?L:z,le=t(ie),se=R.length,ue=R[ie],de="boolean"==typeof a?a:se>a,[he,me,fe]=function(e,o){const[,r]=n(e=>!e,!1),a=t(0),[c,l]=function(n){const o=t(n);function r(e){o.current=e}return i(()=>{(t=>{e?(t(e),a.current=1):a.current=2})(r)},[n]),[o.current,r]}(e);return[c,a.current,function(){r(),2===a.current&&(l(!1),o&&o()),a.current=0}]}(I,F);k(()=>{if(he)return B({pause:!0,x:ie*-(innerWidth+20)}),void(le.current=ie);B(G)},[he]);const{close:ve,changeIndex:ge}=g({close(e){re&&re(0),B({overlay:!0,lastBg:Q}),H(e)},changeIndex(e,t=!1){const n=de?le.current+(e-ie):e,o=se-1,r=x(n,0,o),a=de?n:r,i=innerWidth+20;B({touched:!1,x:-i*le.current,lastCX:void 0,lastCY:void 0,bg:h,overlay:ee}),B({touched:!1,lastCX:void 0,lastCY:void 0,x:-i*a,pause:t}),le.current=a,ce&&ce(de?e<0?o:e>o?0:e:r)}});function pe(e){return e?ve():B({overlay:!ee})}function we(){B({x:-(innerWidth+20)*ie,lastCX:void 0,lastCY:void 0,pause:!0}),le.current=ie}_("keydown",e=>{if(I)switch(e.key){case"ArrowLeft":ge(ie-1,!0);break;case"ArrowRight":ge(ie+1,!0);break;case"Escape":ve()}});const be=function(e,t,n){return i(()=>{const o=e.length;return n?e.concat(e).concat(e).slice(o+t-1,o+t+2):e.slice(Math.max(t-1,0),Math.min(t+2,o+1))},[e,t,n])}(R,ie,de);if(r(()=>{setTimeout(()=>{var e;null==(e=document.querySelector(".Slider_scale"))||e.classList.remove("slider-transitions")},100)},[ie]),!he)return null;const ye=ee&&!me,Ee=I?Q:Z,xe=oe&&re&&{images:R,index:ie,visible:I,onClose:ve,onIndexChange:ge,overlayVisible:ye,overlay:ue&&ue.overlay,scale:te,rotate:ne,onScale:oe,onRotate:re},Ce=c?c(me):400,ke=s?s(me):b,_e=c?c(3):600,Pe=s?s(3):b;return e.createElement(N,{className:`PhotoView-Portal${ye?"":" PhotoView-Slider__clean"}${I?"":" PhotoView-Slider__willClose"}${C?` ${C}`:""}`,role:"dialog",onClick:e=>e.stopPropagation(),container:D},I&&e.createElement(X,null),e.createElement("div",{className:`PhotoView-Slider__Backdrop${P?` ${P}`:""}${1===me?" PhotoView-Slider__fadeIn":2===me?" PhotoView-Slider__fadeOut":""}`,style:{background:Ee?`rgba(0, 0, 0, ${Ee})`:void 0,transitionTimingFunction:ke,transitionDuration:`${U?0:Ce}ms`,animationDuration:`${Ce}ms`},onAnimationEnd:fe}),f&&e.createElement("div",{className:"PhotoView-Slider__BannerWrap"},e.createElement("div",{className:"PhotoView-Slider__Counter"},ie+1," / ",se),e.createElement("div",{className:"PhotoView-Slider__BannerRight"},w&&xe&&w(xe),e.createElement($,{className:"close",onClick:ve}))),e.createElement("div",{className:"Slider_scale"},be.map((t,n)=>{const o=de||0!==ie?le.current-1+n:ie+n;return e.createElement(K,{key:de?`${t.key}/${t.src}/${o}`:t.key,item:t,speed:Ce,easing:ke,visible:I,onPhotoTap:()=>pe(u),onMaskTap:()=>pe(d),wrapClassName:M,className:W,style:{left:(innerWidth+20)*o+"px",transform:`translate3d(${j}px, 0px, 0)`,transition:U||J?void 0:`transform ${_e}ms ${Pe}`},loadingElement:T,brokenElement:V,onPhotoResize:we,isActive:le.current===o,expose:B})})),!E&&f&&e.createElement(e.Fragment,null,(de||0!==ie)&&e.createElement("div",{className:"PhotoView-Slider__ArrowLeft",onClick:()=>{var e;null==(e=document.querySelector(".Slider_scale"))||e.classList.add("slider-transitions"),ge(ie-1)}},e.createElement(S,null)),(de||ie+1<se)&&e.createElement("div",{className:"PhotoView-Slider__ArrowRight",onClick:()=>{var e;null==(e=document.querySelector(".Slider_scale"))||e.classList.add("slider-transitions"),ge(ie+1)}},e.createElement(Y,null))),v&&xe&&e.createElement("div",{className:"PhotoView-Slider__Overlay"},v(xe)))}const J=["children","onIndexChange","onVisibleChange"],Q={images:[],visible:!1,index:0};function Z(n){let{children:o,onIndexChange:r,onVisibleChange:a}=n,c=v(n,J);const[l,s]=p(Q),u=t(0),{images:d,visible:h,index:m}=l,b=g({nextId:()=>u.current+=1,update(e){const t=d.findIndex(t=>t.key===e.key);if(t>-1){const n=d.slice();return n.splice(t,1,e),void s({images:n})}s(t=>({images:t.images.concat(e)}))},remove(e){s(t=>{const n=t.images.filter(t=>t.key!==e);return{images:n,index:Math.min(n.length-1,m)}})},show(e){const t=d.findIndex(t=>t.key===e);s({visible:!0,index:t}),a&&a(!0,t,l)}}),y=g({close(){s({visible:!1}),a&&a(!1,m,l)},changeIndex(e){s({index:e}),r&&r(e,l)}}),E=i(()=>f({},l,b),[l,b]);return e.createElement(w.Provider,{value:E},o,e.createElement(U,f({images:d,visible:h,index:m,onIndexChange:y.changeIndex,onClose:y.close},c)))}const ee=({src:e,render:n,overlay:o,width:a,height:c,triggers:l=["onClick"],children:m})=>{const v=s(w),p=function(){const{current:e}=t({sign:!1,fn:void 0});return e.sign||(e.sign=!0,e.fn=v.nextId()),e.fn}(),b=t(null);u(null==m?void 0:m.ref,()=>b.current),r(()=>()=>{v.remove(p)},[]);const y=g({render:e=>n&&n(e),show(e,t){v.show(p),function(e,t){if(m){const n=m.props[e];n&&n(t)}}(e,t)}}),E=i(()=>{const e={};return l.forEach(t=>{e[t]=y.show.bind(null,t)}),e},[]);if(r(()=>{v.update({key:p,src:e,originRef:b,render:y.render,overlay:o,width:a,height:c})},[e]),m){const e=d.only(h(m,f({},E,{ref:b})));return React.createElement(React.Fragment,null,e)}return null};export{Z as PhotoProvider,U as PhotoSlider,ee as PhotoView};
//# sourceMappingURL=react-photo-view.modern.js.map
