{"code":"import { computePositionEdge } from '../utils/edgeHandle';\r\nimport getPositionOnMoveOrScale from '../utils/getPositionOnMoveOrScale';\r\nimport getRotateSize from '../utils/getRotateSize';\r\nimport { defaultSpeed, maxTouchTime } from '../variables';\r\nimport useMethods from './useMethods';\r\n// 触边运动反馈\r\nconst rebound = (start, bound, callback) => easeOutMove(start, bound, callback, defaultSpeed / 4, (t) => t, () => easeOutMove(bound, start, callback));\r\n/**\r\n * 物理滚动到具体位置\r\n */\r\nexport default function useScrollPosition(callbackX, callbackY, callbackS) {\r\n    const callback = useMethods({\r\n        X: (spatial) => callbackX(spatial),\r\n        Y: (spatial) => callbackY(spatial),\r\n        S: (spatial) => callbackS(spatial),\r\n    });\r\n    return (x, y, lastX, lastY, width, height, scale, safeScale, lastScale, rotate, touchedTime) => {\r\n        const [currentWidth, currentHeight] = getRotateSize(rotate, width, height);\r\n        // 开始状态下边缘触发状态\r\n        const [beginEdgeX, beginX] = computePositionEdge(x, safeScale, currentWidth, innerWidth);\r\n        const [beginEdgeY, beginY] = computePositionEdge(y, safeScale, currentHeight, innerHeight);\r\n        const moveTime = Date.now() - touchedTime;\r\n        // 时间过长、超出安全范围的情况下不执行滚动逻辑，恢复安全范围\r\n        if (moveTime >= maxTouchTime || safeScale !== scale || Math.abs(lastScale - scale) > 1) {\r\n            // 计算中心缩放点\r\n            const { x: nextX, y: nextY } = getPositionOnMoveOrScale(x, y, width, height, scale, safeScale);\r\n            const targetX = beginEdgeX ? beginX : nextX !== x ? nextX : null;\r\n            const targetY = beginEdgeY ? beginY : nextY !== y ? nextY : null;\r\n            if (targetX !== null) {\r\n                easeOutMove(x, targetX, callback.X);\r\n            }\r\n            if (targetY !== null) {\r\n                easeOutMove(y, targetY, callback.Y);\r\n            }\r\n            if (safeScale !== scale) {\r\n                easeOutMove(scale, safeScale, callback.S);\r\n            }\r\n            return;\r\n        }\r\n        // 初始速度\r\n        const speedX = (x - lastX) / moveTime;\r\n        const speedY = (y - lastY) / moveTime;\r\n        const speedT = Math.sqrt(speedX ** 2 + speedY ** 2);\r\n        // 是否接触到边缘\r\n        let edgeX = false;\r\n        let edgeY = false;\r\n        scrollMove(speedT, (spatial) => {\r\n            const nextX = x + spatial * (speedX / speedT);\r\n            const nextY = y + spatial * (speedY / speedT);\r\n            const [isEdgeX, currentX] = computePositionEdge(nextX, scale, currentWidth, innerWidth);\r\n            const [isEdgeY, currentY] = computePositionEdge(nextY, scale, currentHeight, innerHeight);\r\n            if (isEdgeX && !edgeX) {\r\n                edgeX = true;\r\n                if (beginEdgeX) {\r\n                    easeOutMove(nextX, currentX, callback.X);\r\n                }\r\n                else {\r\n                    rebound(currentX, nextX + (nextX - currentX), callback.X);\r\n                }\r\n            }\r\n            if (isEdgeY && !edgeY) {\r\n                edgeY = true;\r\n                if (beginEdgeY) {\r\n                    easeOutMove(nextY, currentY, callback.Y);\r\n                }\r\n                else {\r\n                    rebound(currentY, nextY + (nextY - currentY), callback.Y);\r\n                }\r\n            }\r\n            // 同时接触边缘的情况下停止滚动\r\n            if (edgeX && edgeY) {\r\n                return false;\r\n            }\r\n            const resultX = edgeX || callback.X(currentX);\r\n            const resultY = edgeY || callback.Y(currentY);\r\n            return resultX && resultY;\r\n        });\r\n    };\r\n}\r\n// 加速度\r\nconst acceleration = -0.001;\r\n// 阻力\r\nconst resistance = 0.0002;\r\n/**\r\n * 通过速度滚动到停止\r\n */\r\nfunction scrollMove(initialSpeed, callback) {\r\n    let v = initialSpeed;\r\n    let s = 0;\r\n    let lastTime;\r\n    let frameId = 0;\r\n    const calcMove = (now) => {\r\n        if (!lastTime) {\r\n            lastTime = now;\r\n        }\r\n        const dt = now - lastTime;\r\n        const direction = Math.sign(initialSpeed);\r\n        const a = direction * acceleration;\r\n        const f = Math.sign(-v) * v ** 2 * resistance;\r\n        const ds = v * dt + ((a + f) * dt ** 2) / 2;\r\n        v += (a + f) * dt;\r\n        s += ds;\r\n        // move to s\r\n        lastTime = now;\r\n        if (direction * v <= 0) {\r\n            caf();\r\n            return;\r\n        }\r\n        if (callback(s)) {\r\n            raf();\r\n            return;\r\n        }\r\n        caf();\r\n    };\r\n    raf();\r\n    function raf() {\r\n        frameId = requestAnimationFrame(calcMove);\r\n    }\r\n    function caf() {\r\n        cancelAnimationFrame(frameId);\r\n    }\r\n}\r\n/**\r\n * 缓动函数\r\n */\r\nconst easeOutQuart = (x) => 1 - (1 - x) ** 4;\r\n/**\r\n * 缓动回调\r\n */\r\nfunction easeOutMove(start, end, callback, speed = defaultSpeed, easing = easeOutQuart, complete) {\r\n    const distance = end - start;\r\n    if (distance === 0) {\r\n        return;\r\n    }\r\n    const startTime = Date.now();\r\n    let frameId = 0;\r\n    const calcMove = () => {\r\n        const time = Math.min(1, (Date.now() - startTime) / speed);\r\n        const result = callback(start + easing(time) * distance);\r\n        if (result && time < 1) {\r\n            raf();\r\n            return;\r\n        }\r\n        cancelAnimationFrame(frameId);\r\n        if (time >= 1 && complete) {\r\n            complete();\r\n        }\r\n    };\r\n    raf();\r\n    function raf() {\r\n        frameId = requestAnimationFrame(calcMove);\r\n    }\r\n}\r\n//# sourceMappingURL=useScrollPosition.js.map","references":["/Users/georgiiborisov/Documents/Nvsert--nextjs/src/assets/lib/react-photo-view/src/utils/edgeHandle.ts","/Users/georgiiborisov/Documents/Nvsert--nextjs/src/assets/lib/react-photo-view/src/utils/getPositionOnMoveOrScale.ts","/Users/georgiiborisov/Documents/Nvsert--nextjs/src/assets/lib/react-photo-view/src/utils/getRotateSize.ts","/Users/georgiiborisov/Documents/Nvsert--nextjs/src/assets/lib/react-photo-view/src/variables.ts","/Users/georgiiborisov/Documents/Nvsert--nextjs/src/assets/lib/react-photo-view/src/hooks/useMethods.ts"],"map":"{\"version\":3,\"file\":\"useScrollPosition.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/hooks/useScrollPosition.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/georgiiborisov/Documents/Nvsert--nextjs/src/assets/lib/react-photo-view/dist/hooks/useScrollPosition.d.ts","writeByteOrderMark":false,"text":"/**\r\n * 物理滚动到具体位置\r\n */\r\nexport default function useScrollPosition<C extends (spatial: number) => boolean>(callbackX: C, callbackY: C, callbackS: C): (x: number, y: number, lastX: number, lastY: number, width: number, height: number, scale: number, safeScale: number, lastScale: number, rotate: number, touchedTime: number) => void;\r\n"}}
